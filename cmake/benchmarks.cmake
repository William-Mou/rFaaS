
add_library(benchmarks STATIC benchmarks/settings.cpp)
target_include_directories(benchmarks PRIVATE $<TARGET_PROPERTY:rfaaslib,INTERFACE_INCLUDE_DIRECTORIES>)
target_include_directories(benchmarks PRIVATE $<TARGET_PROPERTY:spdlog::spdlog,INTERFACE_INCLUDE_DIRECTORIES>)
target_link_libraries(benchmarks INTERFACE rfaaslib)

add_executable(warm_benchmarker benchmarks/warm_benchmark.cpp benchmarks/warm_benchmark_opts.cpp)
add_executable(parallel_invocations benchmarks/parallel_invocations.cpp benchmarks/parallel_invocations_opts.cpp)
add_executable(cold_benchmarker benchmarks/cold_benchmark.cpp benchmarks/cold_benchmark_opts.cpp)
add_executable(cpp_interface benchmarks/cpp_interface.cpp benchmarks/cpp_interface_opts.cpp)
if ( ${WITH_SCALABILITY} )
add_executable(scalable_benchmarker benchmarks/scalable_benchmark.cpp benchmarks/scalable_benchmark_opts.cpp)
set(tests_targets "warm_benchmarker" "cold_benchmarker" "parallel_invocations" "cpp_interface" "scalable_benchmarker")
else()
set(tests_targets "warm_benchmarker" "cold_benchmarker" "parallel_invocations" "cpp_interface")
endif()
foreach(target ${tests_targets})
  add_dependencies(${target} cxxopts::cxxopts)
  add_dependencies(${target} rdmalib)
  add_dependencies(${target} rfaaslib)
  add_dependencies(${target} benchmarks)
  target_include_directories(${target} PRIVATE $<TARGET_PROPERTY:rdmalib,INTERFACE_INCLUDE_DIRECTORIES>)
  target_include_directories(${target} PRIVATE $<TARGET_PROPERTY:rfaaslib,INTERFACE_INCLUDE_DIRECTORIES>)
  target_include_directories(${target} SYSTEM PRIVATE $<TARGET_PROPERTY:cxxopts::cxxopts,INTERFACE_INCLUDE_DIRECTORIES>)
  target_link_libraries(${target} PRIVATE spdlog::spdlog)
  target_link_libraries(${target} PRIVATE rfaaslib)
  target_link_libraries(${target} PRIVATE benchmarks)
  set_target_properties(${target} PROPERTIES RUNTIME_OUTPUT_DIRECTORY benchmarks)
endforeach()

if( ${WITH_GNI_AUTH} )
add_executable(credentials benchmarks/credentials.cpp)
target_include_directories(credentials SYSTEM PUBLIC $<TARGET_PROPERTY:PkgConfig::drc,INTERFACE_INCLUDE_DIRECTORIES>)
target_link_libraries(credentials PUBLIC PkgConfig::drc)
set_target_properties(credentials PROPERTIES RUNTIME_OUTPUT_DIRECTORY benchmarks)
endif()
